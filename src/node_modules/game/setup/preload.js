/* eslint no-console: 'off' */
import axios from 'axios';
import {loaders} from 'pixi.js';
import * as resources from 'game/resources';
import {textureMap} from 'shared/config';

window.res = resources;

export default () => {
  return new Promise((resolve, reject) => {
    axios.get(textureMap)
      .then((response) => {
        const map = response.data;
        const loader = new loaders.Loader();
        for (const key in map) {
          loader.add(key, map[key]);
        }
        loader.on('load', (_loader, resource) => {
          console.info(`Loaded ${resource.name} from ${resource.url}`);
        });
        // TODO: This is never called (at least on 404 responses).
        loader.on('error', (_loader, resource) => {
          console.error(`Failed to load ${resource.name} from ${resource.url}`);
        });
        loader.load(() => {
          for (const key in loader.resources) {
            const resource = loader.resources[key];
            resources.rawCache[key] = resource;
          }
          resolve();
        });
      })
      .catch((err) => {
        reject(err);
      });
  });
};
